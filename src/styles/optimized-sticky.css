/**
 * Оптимизированные CSS стили для sticky элементов
 * Исправляет проблемы с "дрибежжанием" и повышает производительность
 */

/* Базовые оптимизации для всех sticky элементов */
.sticky-optimized {
  /* GPU ускорение */
  will-change: transform;
  transform: translate3d(0, 0, 0);

  /* Сглаживание анимаций */
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;

  /* Оптимизация рендеринга */
  contain: layout style paint;

  /* Убираем дрожание на субпиксельных значениях */
  -webkit-transform: translateZ(0);
  -moz-transform: translateZ(0);
  -ms-transform: translateZ(0);
  -o-transform: translateZ(0);
  transform: translateZ(0);
}

/* Состояние во время активного скролла - отключаем transitions */
.sticky-optimized.sticky-scrolling {
  transition: none !important;
  animation: none !important;
}

/* Состояние после окончания скролла - включаем плавные переходы */
.sticky-optimized.sticky-stable {
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Оптимизация для элементов с изменяющимся z-index */
.sticky-optimized.sticky-layered {
  isolation: isolate;
  position: relative;
}

/* Оптимизация для sticky элементов в группах */
.sticky-group-optimized {
  contain: layout;
  position: relative;
}

.sticky-group-optimized .sticky-optimized {
  position: relative;
}

/* Оптимизация для контейнеров с кастомным скроллом */
.sticky-container-optimized {
  /* Создаем новый контекст наложения */
  position: relative;
  z-index: 0;

  /* Оптимизация скролла */
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;

  /* Сдерживание перерисовок */
  contain: layout style;
}

/* Предотвращение layout shift */
.sticky-optimized.sticky-measuring {
  visibility: hidden;
  pointer-events: none;
}

/* Медиа-запросы для мобильных устройств */
@media (max-width: 768px) {
  .sticky-optimized {
    /* Более агрессивная оптимизация на мобильных */
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);

    /* Отключаем hover эффекты для экономии ресурсов */
    pointer-events: auto;
  }

  .sticky-optimized:hover {
    /* Отключаем hover на touch устройствах */
    pointer-events: none;
  }
}

/* Для устройств с низкой производительностью */
@media (max-resolution: 150dpi) {
  .sticky-optimized {
    /* Упрощаем эффекты */
    will-change: auto;
    transition-duration: 0.1s;
  }
}

/* Prefers-reduced-motion для пользователей с ограничениями */
@media (prefers-reduced-motion: reduce) {
  .sticky-optimized {
    transition: none !important;
    animation: none !important;
    will-change: auto;
  }
}

/* Debug стили для разработки */
.sticky-debug {
  outline: 2px dashed rgba(255, 0, 0, 0.5);
  background: rgba(255, 0, 0, 0.1);
}

.sticky-debug::before {
  content: attr(data-sticky-state);
  position: absolute;
  top: -20px;
  left: 0;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 2px 6px;
  font-size: 10px;
  border-radius: 3px;
  pointer-events: none;
  z-index: 10000;
}
